---
title: "TypeScript (ã¨ VSCodeã®REST Client) ã§multipart/form-dataã®ãƒ‡ãƒ¼ã‚¿ã‚’é€å—ä¿¡"
emoji: "ğŸ—‚"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: [typescript, vscode, nodejs, express, axios]
published: true
---

# ã¯ã˜ã‚ã«
TypeScriptã§ãƒ•ã‚¡ã‚¤ãƒ«ã‚’POSTã—ã¦ã€ãã‚Œã‚’å—ã‘å–ã‚‹æ–¹æ³•ãŒã‚ˆãåˆ†ã‹ã£ã¦ãªã‹ã£ãŸã®ã§ã€èª¿ã¹ãªãŒã‚‰å®Ÿè£…ã—ãŸã€‚HTTPã§`multipart/form-data`ã‚’é€ã‚‹ã¨ãã®`boundary`ã«ã¤ã„ã¦ã‚‚å°‘ã—ç†è§£ãŒæ·±ã¾ã£ãŸã®ã§ã€è¨˜éŒ²ã€‚

# ã‚³ãƒ¼ãƒ‰
ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã®ã‚³ãƒ¼ãƒ‰ã¨ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã®ã‚³ãƒ¼ãƒ‰ã¨ãƒ†ã‚¹ãƒˆç”¨ã®VSCodeã®REST Clientã®ã‚³ãƒ¼ãƒ‰ã‚’æ•´ç†ã€‚

## multer @ ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰
ã“ã‚“ãªæ„Ÿã˜ã§å—ã‘å–ã£ã¦ã€å‡¦ç†ã™ã‚‹ã€‚
å—ã‘å–ã£ãŸãƒ•ã‚¡ã‚¤ãƒ«ã¯ãƒ¡ãƒ¢ãƒªã«ä¿å­˜ã—ãŸã‹ã£ãŸã®ã§ã€`storage`ã«`multer.memoryStorage`ã‚’æŒ‡å®šã—ã¦ã‚‹ã€‚`dest`ã«ãƒ‘ã‚¹ã‚’æŒ‡å®šã—ãŸã‚‰ãƒ•ã‚¡ã‚¤ãƒ«ã¨ã—ã¦ä¿å­˜ã•ã‚Œã‚‹ã¿ãŸã„ã€‚

```typescript
import express from 'express';
import multer from 'multer';

const app = express()

const upload = multer({ storage: multer.memoryStorage() })
// const upload = multer({ dest: 'uploads/' })

app.post('/api/upload', upload.single('file'), (req: express.Request, res: express.Response, next: express.NextFunction) => {
  console.log(req.file)
})
```

## axios @ ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰
ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã§axiosã‚’ä½¿ã†ãªã‚‰ã€ã“ã‚“ãªæ„Ÿã˜ã€‚`file`ã¯Blobã§ã‚‚é€ã‚ŒãŸã€‚

```typescript
const file = fs.createReadStream('./audio.wav');
const data = new formData();
data.append('file', file);
axios.post('/api/upload', data, {
    headers: {
        'content-type': 'multipart/form-data',
    }
})
```

## REST Client @ VSCode
ã“ã‚“ãªæ„Ÿã˜ã§ãƒ•ã‚¡ã‚¤ãƒ«ã‚’`multipart/form-data`ã¨ã—ã¦postã§ãã‚‹ã€‚ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰å´ã§`upload.single('file')`ã¨ã—ã¦å—ã‘å–ã‚Œã‚‹ã‚ˆã†ã«ã€name="file"ã¨ã—ã¦ãƒ‡ãƒ¼ã‚¿ã‚’é€ã£ã¦ã‚‹ã€‚

```http:.http
### upload
POST http://localhost:8000/api/upload
Content-Type: multipart/form-data; boundary=MyBoundary

--MyBoundary
Content-Disposition: form-data; name="file"; filename="audio.wav"
Content-Type: audio/wav

< ./audio.wav
--MyBoundary--
```

# ãŠã‚ã‚Šã«
boundaryã‚ˆãã‚ã‹ã‚‰ã‚“ã¾ã¾ä½¿ãŠã†ã¨ã—ãŸã‘ã©ã€å‡¡ãƒŸã‚¹ã§ã†ã¾ãå‹•ã‹ãšã¾ã˜ã‚ã«èª¿ã¹ãŸã€‚HTTPã®ãƒ–ãƒ©ãƒƒã‚¯ãƒœãƒƒã‚¯ã‚¹ã‚„ã£ãŸéƒ¨åˆ†ã‚’å£é–“è¦‹ã‚Œã¦ã‚ˆã‹ã£ãŸã€‚
ã‚ã¨ã‚„ã£ã±ã‚Šã€REST Clientã™ã”ãä¾¿åˆ©ã€‚

# å‚è€ƒ
ã“ã“ã‚‰è¾ºãŒå‚è€ƒã«ãªã£ãŸã€‚ã‚ã‚ŠãŒãŸã‚„ã€‚

## Multer @ ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰
[expressjs/multer: Node.js middleware for handling `multipart/form-data`.](https://github.com/expressjs/multer)

ã“ã‚Œã‚’ä½¿ã£ãŸã‚‰ã€å—ã‘å–ã£ãŸãƒ•ã‚¡ã‚¤ãƒ«ã®ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ã‚’ã„ã„æ„Ÿã˜ã«ã§ãã‚‹ã€‚

## axios x form-data @ ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰
[axios/axios: Promise based HTTP client for the browser and node.js](https://github.com/axios/axios)
[Node.jsã‹ã‚‰Expressã¸ãƒ•ã‚¡ã‚¤ãƒ«ã®ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã‚’å‡¦ç†ã™ã‚‹æ–¹æ³• | www.twilio.com](https://www.twilio.com/blog/handle-file-uploads-node-express-jp)

axiosã¨form-dataä½¿ã£ãŸã‚‰ã€ç°¡å˜ã«é€ã‚Œã‚‹ã€‚

## REST Client @ VSCode
[Huachao/vscode-restclient: REST Client Extension for Visual Studio Code](https://github.com/Huachao/vscode-restclient)

`multipart/form-data`ã®postã®ä»•æ–¹ã‚‚æ›¸ã‹ã‚Œã¦ã‚‹ã€‚

## `multipart/form-data` @ HTTP
[Content-Type - HTTP | MDN](https://developer.mozilla.org/ja/docs/Web/HTTP/Headers/Content-Type)
[ã€HTTPã€‘multipart/form-data ã® boundary ã£ã¦ä½•ãã‚„ï¼Ÿ - Qiita](https://qiita.com/kunihiros/items/e11daacfd62d85d83c06)

boundaryã¨ã‹ãŒã‚ˆãã‚ã‹ã‚‰ãªã‹ã£ãŸã®ã§èª¿ã¹ãŸã€‚ã“ã“ã‚‰ã«æ›¸ã„ã¦ã‚ã£ãŸã€‚ãµã‚€ãµã‚€ã€‚
