---
title: "Pythonã®ä»®æƒ³ç’°å¢ƒvenvã‚’ã¡ã‚ƒã‚“ã¨ç†è§£ã™ã‚‹"
emoji: "ğŸ"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: [python, venv, pyenv]
published: true
---

# ã¯ã˜ã‚ã«

Python ã® venv ã‚’ãªã‚“ã¨ãªãã§ä½¿ã£ã¦ãŸã‚“ã§ã™ãŒã€æœŸå¾…ã™ã‚‹ Python ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã‚„ pip ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã«ãªã‚‰ãªãã¦ãƒ¢ãƒ¤ãƒ¢ãƒ¤ã—ã¦ãŸã®ã§ã€çœŸé¢ç›®ã«å‹•ãã‚’ç¢ºèªã—ã¾ã—ãŸã€‚å®Œå…¨ã«ç†è§£ã—ãŸã®ã§å…±æœ‰ã§ã™ã€‚

# `python -m venv .venv`ã§ä½œã‚‰ã‚Œã‚‹ã‚‚ã®

ã¾ãšã€venv ã§ä»®æƒ³ç’°å¢ƒä½œã‚‹å‰ã«ã€ç¾çŠ¶ã®ã©ã® python ã‚’ä½¿ã£ã¦ã‚‹ã‹ã¿ã¦ã¿ã¾ã™ã€‚
ç§ã®ç’°å¢ƒã ã¨ã€pyenv ã‚’ä½¿ã£ã¦ã‚‹ã®ã§ã€ã“ã®ãƒ‘ã‚¹ã« python ãŒã‚ã‚Šã¾ã™ã€‚ã›ã£ã‹ããªã®ã§ã€ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã‚’å¤‰æ›´ã—ã¦ã¿ã¾ã™ã€‚

```
% which python
/Users/optimisuke/.pyenv/shims/python
% python -V
Python 3.11.6
% pyenv local 3.12
% python -V
Python 3.12.0
% which python
/Users/optimisuke/.pyenv/shims/python
```

æ¬¡ã«ã€venv ç’°å¢ƒã‚’ã¤ãã‚Šã¾ã™ã€‚

```
% python -m venv .venv
```

ã“ã®æ™‚ç‚¹ã§ã¯ã€ä½¿ã£ã¦ã‚‹ python ã«å¤‰æ›´ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚

```
% which python
/Users/optimisuke/.pyenv/shims/python
```

ä½œã‚‰ã‚ŒãŸãƒ•ã‚©ãƒ«ãƒ€ã® bin ã‚’ã¿ã¦ã¿ã¾ã™ã€‚

```
% ls -ltr .venv/bin
total 72
lrwxr-xr-x 1 optimisuke staff 44 Dec 16 23:12 python -> /Users/optimisuke/.pyenv/versions/3.12.0/bin/python
lrwxr-xr-x 1 optimisuke staff 6 Dec 16 23:12 python3 -> python
lrwxr-xr-x 1 optimisuke staff 6 Dec 16 23:12 python3.12 -> python
-rwxr-xr-x 1 optimisuke staff 251 Dec 16 23:12 pip
-rwxr-xr-x 1 optimisuke staff 251 Dec 16 23:12 pip3
-rwxr-xr-x 1 optimisuke staff 251 Dec 16 23:12 pip3.12
-rw-r--r-- 1 optimisuke staff 2210 Dec 16 23:12 activate.fish
-rw-r--r-- 1 optimisuke staff 931 Dec 16 23:12 activate.csh
-rw-r--r-- 1 optimisuke staff 9033 Dec 16 23:12 Activate.ps1
-rw-r--r-- 1 optimisuke staff 2350 Dec 16 23:12 activate
```

python ã®ã‚·ãƒ³ãƒœãƒªãƒƒã‚¯ãƒªãƒ³ã‚¯ï¼ˆã‚¨ã‚¤ãƒªã‚¢ã‚¹ï¼‰ãŒã‚ã‚‹ã“ã¨ãŒã‚ã‹ã‚Šã¾ã™ã€‚pyenv ã§å…¥ã‚ŒãŸ python ã®å®Ÿæ…‹ã«ãƒªãƒ³ã‚¯ã•ã‚Œã¦ãã†ã§ã™ã€‚
`python -m venv .venv`ã™ã‚‹ã‚¿ã‚¤ãƒŸãƒ³ã‚°ã§æœ‰åŠ¹ã«ãªã£ã¦ã‚‹ python ãŒä½¿ã‚ã‚Œãã†ã§ã™ã€‚

# `source .venv/bin/activate`ã—ãŸã‚‰å®Ÿè¡Œã•ã‚Œã‚‹ã‚‚ã®

activate ã—ã¦ã¿ã¾ã™ã€‚æœŸå¾…é€šã‚Šã® python ã‚’å®Ÿè¡Œã§ããã†ã§ã™ã€‚ä½•ãŒèµ·ããŸã®ã§ã—ã‚‡ã†ï¼Ÿ

```
% source .venv/bin/activate
% which python
/Users/optimisuke/Repos/sandbox/gradio/.venv/bin/python
% python -V
Python 3.12.0
```

activate ã‚’è¦‹ã¦ã¿ã‚‹ã¨ã€ãŸã ã®ã‚·ã‚§ãƒ«ã‚¹ã‚¯ãƒªãƒ—ãƒˆã§ã™ã€‚å¤§äº‹ãªã®ã¯ã“ã“ã ã‘ã§ã™ã€‚ä½œã£ãŸ`.venv`ã¸ã®ãƒ‘ã‚¹ã‚’é€šã—ã¦ã‚‹ã ã‘ã§ã™ã€‚

```activate
VIRTUAL_ENV="/Users/optimisuke/Repos/sandbox/gradio/.venv"
export VIRTUAL_ENV

_OLD_VIRTUAL_PATH="$PATH"
PATH="$VIRTUAL_ENV/bin:$PATH"
export PATH
```

ãƒ‘ã‚¹ã‚’è¦‹ã¦ã¿ã‚‹ã¨ã“ã‚“ãªæ„Ÿã˜ã§ã™ã€‚å…ˆé ­ã«ãƒ‘ã‚¹ãŒè¿½åŠ ã•ã‚Œã‚‹ã®ã§ã€ã‚³ãƒãƒ³ãƒ‰ã‚’æ‰“ã£ãŸæ™‚ã«æœ€åˆã«æ¤œç´¢ã•ã‚Œã¾ã™ã€‚python ã‚³ãƒãƒ³ãƒ‰å®Ÿè¡Œæ™‚ã«ä½¿ã‚ã‚Œã‚‹å®Ÿè¡Œãƒ•ã‚¡ã‚¤ãƒ«ãŒå¤‰ã‚ã£ãŸã®ã¯ã“ã‚Œã ã‘ã§ã—ãŸã­ã€‚pip ã‚‚åŒã˜ã‚ˆã†ã«`.venv/bin`ã«ã‚ã‚‹ã®ã§ãã‚ŒãŒä½¿ã‚ã‚Œã¾ã™ã€‚

```
% echo $PATH
/Users/optimisuke/Repos/sandbox/gradio/.venv/bin:/Users/optimisuke/.deno/bin:/Users/optimisuke/.local/bin
```

# vscode ã®ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ—ãƒªã‚¿å€™è£œã«è¡¨ç¤ºã•ã‚Œã‚‹ã‚‚ã®

å³ä¸‹ã«æ›¸ã‹ã‚Œã¦ã‚‹ python ã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ãŒã€ãŸã¾ã« python ã‚³ãƒãƒ³ãƒ‰ã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã¨ãšã‚ŒãŸã‚Šã—ã¾ã™ã€‚vscode ã«ã©ã‚Œã‚’ä½¿ã£ã¦ã„ã‚‹ã‹æ•™ãˆã¦ã‚ã’ãªã„ã¨ lint ã¨ã‹ã‚‚ã†ã¾ãã„ãã¾ã›ã‚“ã€‚ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§ã¯ã€ãƒ¯ãƒ¼ã‚¯ã‚¹ãƒšãƒ¼ã‚¹ã‚‚æ¢ã—ã¦ãã‚Œã‚‹ã¿ãŸã„ã§ã™ãŒã€ãƒ¯ãƒ¼ã‚¯ã‚¹ãƒšãƒ¼ã‚¹ã«ãƒ•ã‚©ãƒ«ãƒ€ä½œã£ã¦ãã£ã¡ã§ä½œæ¥­ã—ã¦ã‚‹ã¨ã†ã¾ãã„ãã¾ã›ã‚“ã€‚å€™è£œã«å‡ºã¦ã“ãªã„å ´åˆã¯`.venv`å†…ã®ãƒ‘ã‚¹ã‚’æŒ‡å®šã—ã¦æ•™ãˆã¦ã‚ã’ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚
![](/images/2023-12-16-23-36-00.png)

ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§æ¢ã™ãƒ•ã‚©ãƒ«ãƒ€ã¯`settings.json`ã§è¨­å®šã§ãã‚‹ã¿ãŸã„ã§ã™ã€‚

https://tekunabe.hatenablog.jp/entry/2018/12/28/vscode_venv_default_rolad

# `deactivate`ã—ãŸã‚‰å®Ÿè¡Œã•ã‚Œã‚‹ã‚‚ã®

`activate`ãªã„ã«ã‚ã£ãŸä»¥ä¸‹ã®é–¢æ•°ãŒå‘¼ã³å‡ºã•ã‚Œã¾ã™ã€‚ã„ã„æ„Ÿã˜ã«ãƒ‘ã‚¹ãŒé€šã£ã¦ã„ã‚‹ã®ã§ã€ã‚³ãƒãƒ³ãƒ‰ã¨ã—ã¦å‘¼ã³å‡ºã›ã¾ã™ã€‚å¤§äº‹ãªã®ã¯ PATH ã®è¨­å®šã‚’æˆ»ã—ã¦ã„ã‚‹ã¨ã“ã‚ã§ã™ã€‚ã™ã”ãã‚·ãƒ³ãƒ—ãƒ«ã§ã™ã­ã€‚

```activate
deactivate () {
    # reset old environment variables
    if [ -n "${_OLD_VIRTUAL_PATH:-}" ] ; then
        PATH="${_OLD_VIRTUAL_PATH:-}"
        export PATH
        unset _OLD_VIRTUAL_PATH
    fi
    if [ -n "${_OLD_VIRTUAL_PYTHONHOME:-}" ] ; then
        PYTHONHOME="${_OLD_VIRTUAL_PYTHONHOME:-}"
        export PYTHONHOME
        unset _OLD_VIRTUAL_PYTHONHOME
    fi

    # This should detect bash and zsh, which have a hash command that must
    # be called to get it to forget past commands.  Without forgetting
    # past commands the $PATH changes we made may not be respected
    if [ -n "${BASH:-}" -o -n "${ZSH_VERSION:-}" ] ; then
        hash -r 2> /dev/null
    fi

    if [ -n "${_OLD_VIRTUAL_PS1:-}" ] ; then
        PS1="${_OLD_VIRTUAL_PS1:-}"
        export PS1
        unset _OLD_VIRTUAL_PS1
    fi

    unset VIRTUAL_ENV
    unset VIRTUAL_ENV_PROMPT
    if [ ! "${1:-}" = "nondestructive" ] ; then
    # Self destruct!
        unset -f deactivate
    fi
}
```

# ãŠã‚ã‚Šã«

ä»¥ä¸ŠãŒã€venv ã®å‹•ãã§ã—ãŸã€‚èª¿ã¹ã¦ã¿ã‚‹ã¨ã€ã‚‚ã®ã™ã”ãã‚·ãƒ³ãƒ—ãƒ«ã§ã™ã­ã€‚
