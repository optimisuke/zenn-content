---
title: "IBMã®Watson Speech to Textã‚’TypeScriptã§å‘¼ã³å‡ºã—ã¦ã¿ãŸ"
emoji: "ğŸ¤"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: [ibm, typescript]
published: true
---

# ã¯ã˜ã‚ã«
IBMã®Watson Speech to Textã‚’TypeScriptã§å‘¼ã³å‡ºã—ã¦ã¿ãŸã€‚æ—¥æœ¬èªæƒ…å ±å°‘ãªã‚ã‚„ã£ãŸã®ã§è¨˜éŒ²ã€‚
èª¿ã¹ç‰©ã—ãŸã“ã¨ã‚’æœ€åˆã«æ›¸ã„ã¦ã€IBM Cloudã€ã‚³ãƒ¼ãƒ‰ã€å®Ÿè¡Œã«ã¤ã„ã¦ãã‚Œãã‚Œèª¬æ˜ã—ã¦ã€æœ€å¾Œã«ã¾ã¨ã‚ã‚‹ã€‚

# èª¿ã¹ç‰©
## ã‚µãƒ¼ãƒ“ã‚¹ã®æ¦‚è¦
[ã“ã“](https://www.ibm.com/cloud/watson-speech-to-text)ã«æ›¸ã‹ã‚Œã¦ã‚‹ã€‚

## APIã®ä»•æ§˜
[ã“ã“](https://cloud.ibm.com/docs/speech-to-text?topic=speech-to-text-gettingStarted#getting-started-tutorial)ã€‚`curl`ã§å‘¼ã¶æ–¹æ³•ã‚‚æ›¸ã‹ã‚Œã¦ã‚‹ã®ã§ã€ã¾ãšã“ã“ã‹ã‚‰è©¦ã™ã®ãŒè‰¯ã•ã’ã€‚æ™®é€šã«ä½¿ã†ãªã‚‰ã€APIä¸€å›å©ãã ã‘ã§ã€transcribeã—ã¦ãã‚Œã‚‹ã€‚[Amazon Transcribe](https://aws.amazon.com/jp/transcribe/)ã ã¨ã€S3ã«ä¿å­˜ã—ã¦transcribeã™ã‚‹æ„Ÿã˜ã‚„ã‹ã‚‰ã€ã‚·ãƒ³ãƒ—ãƒ«ã¨è¨€ãˆã°ã‚·ãƒ³ãƒ—ãƒ«ãªæ°—ãŒã™ã‚‹ã€‚è¨­è¨ˆã®é•ã„ã‚’å£é–“è¦‹ã‚Œã¦é¢ç™½ã„ã€‚è‰¯ã—æ‚ªã—ã‚ã‚‹ã‚“ã‚„ã‚ãªãƒ¼ã€‚

## SDKã®ä»•æ§˜
[ã“ã“](https://cloud.ibm.com/apidocs/speech-to-text?code=node#recognize)ã€‚è¨€èªã”ã¨ã«Exampleã‚‚è¼‰ã£ã¦ã‚‹ã€‚ã‚ã‚ŠãŒãŸã‚„ã€‚

## Node.jsã®SDK
[ã“ã“](https://github.com/watson-developer-cloud/node-sdk)ã€‚Watson APIså…¨éƒ¨å…¥ã‚Šãªã®ã§ã€Speech to Textã®ã¨ã“ã‚æ¢ã—ã¦ä½¿ã†å¿…è¦ã‚ã‚‹ã€‚

## æ—¥æœ¬èªã®è¨˜äº‹
ã‚ã¾ã‚Šãªã„ã€‚[Speech To Text ã§éŸ³å£°èªè­˜ã—ã¦ã¿ãŸ - Qiita](https://qiita.com/Haruka-Ogawa/items/a022cee97a7455e1e9eb) ã£ã¦ã®ãŒã‚ã£ãŸã‘ã©ã€å¤ã„SDKã‚„ã£ãŸã€‚

## ã‚µãƒ³ãƒ—ãƒ«ã‚³ãƒ¼ãƒ‰
ã¾ãšã¯å…¬å¼ã®[ã“ã“](https://github.com/watson-developer-cloud/node-sdk#speech-to-text)ã¨[ã“ã“](https://cloud.ibm.com/apidocs/speech-to-text?code=node#recognize)ã‚’ã‚³ãƒ”ãƒšã™ã‚‹ã¨ã“ã‚ã‹ã‚‰å§‹ã‚ã‚‹ã®ãŒè‰¯ã•ã’ã€‚è©¦ã—ã¦ãªã„ã‘ã©ã€websocketä½¿ã£ã¦ã‚¹ãƒˆãƒªãƒ¼ãƒŸãƒ³ã‚°å‡¦ç†ã‚‚ã§ãã‚‹ã¿ãŸã„ã€‚websocketã‚ã‹ã‚‰ã‚“ã€‚

# å‰æ
IBM Cloudã®ã‚¢ã‚«ã‚¦ãƒ³ãƒˆæŒã£ã¦ã‚‹ã€‚

# IBM Cloudã§ãƒªã‚½ãƒ¼ã‚¹ã®ç™»éŒ²ã¨API Keyã®å–å¾—ã€‚
ã‚«ã‚¿ãƒ­ã‚°ã‹ã‚‰ã€Speech to Textã‚’æ¢ã™ã€‚
![](/images/583c0c857a349a/catalog-IBM-Cloud.png)

ãƒ­ã‚±ãƒ¼ã‚·ãƒ§ãƒ³ç­‰ã‚’é¸æŠã—ã¦ãƒªã‚½ãƒ¼ã‚¹ã‚’ä½œæˆã™ã‚‹ã€‚
![](/images/583c0c857a349a/Speech-to-Text-IBM-Cloud.png)

ãƒªã‚½ãƒ¼ã‚¹ãƒ»ãƒªã‚¹ãƒˆã‹ã‚‰ä½œæˆã—ãŸSpeech to Textãƒªã‚½ãƒ¼ã‚¹ã‚’é¸ã¶
![](/images/583c0c857a349a/IBM-Cloud.png)
![](/images/583c0c857a349a/resource-IBM-Cloud.png)

API Keyã¨URLã‚’å–å¾—ã™ã‚‹ã€‚
![](/images/583c0c857a349a/IBM-Watson-service.png)

# Node.js x TypeScriptã®è¨­å®š

ã“ã“ã‚‰ã®ã‚³ãƒãƒ³ãƒ‰ã‚’æ‰“ã£ã¦ã€ç’°å¢ƒã‚’ä½œã‚‹ã€‚ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§å‹•ãã€‚
nodeã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã«åˆã‚ã›ã¦ã€`@types/node`ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¦ã‚‹ã€‚

```
npm init
node -v
npm install -D typescript @types/node@14
npx tsc --version
npx tsc --init
npm install -D ibm-watson@^7.0.0 
npm install -D ts-node
```


# ã‚³ãƒ¼ãƒ‰

1. [ã“ã“](https://cloud.ibm.com/apidocs/speech-to-text?code=node#recognize)ã®ã‚³ãƒ¼ãƒ‰ã‚’ã‚³ãƒ”ãƒšã—ã¦ã€
2. ãªã‚“ã¨ãªãã€`require`ã—ã¦ã„ã‚‹ã¨ã“ã‚ã‚’`import`ã«ã—ã¦ã€
3. ä¸è¦ãªãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿å‰Šã£ã¦ã€
4. apikeyã¨serviceUrlã‚’ç’°å¢ƒå¤‰æ•°ã‹ã‚‰å–ã£ã¦ããŸã ã‘ã€‚
   

apikeyã¨serviceUrlã¯ã€ä¸Šè¨˜æ‰‹é †ã§IBM Cloudã‹ã‚‰å–å¾—ã—ãŸã‚‚ã®ã‚’ä½¿ç”¨ã€‚
TypeScriptçš„ã«ã¯linterã«æ€’ã‚‰ã‚Œã¦ãªã„ã‹ã‚‰ã“ã‚Œã§å¤§ä¸ˆå¤«ãã†ã€‚

```typescript
import fs from 'fs';
import SpeechToTextV1 from 'ibm-watson/speech-to-text/v1';
import { IamAuthenticator } from 'ibm-watson/auth';

const speechToText = new SpeechToTextV1({
    authenticator: new IamAuthenticator({
        apikey: process.env.SPEECH_TO_TEXT_APIKEY || '',
    }),
    serviceUrl: process.env.SPEECH_TO_TEXT_SERVICE_URL || '',
});

const recognizeParams = {
    audio: fs.createReadStream('audio-file.flac'),
    contentType: 'audio/flac',
};

speechToText.recognize(recognizeParams)
    .then(speechRecognitionResults => {
        console.log(JSON.stringify(speechRecognitionResults, null, 2));
    })
    .catch(err => {
        console.log('error:', err);
    });
```

# å®Ÿè¡Œ
å®Ÿè¡Œã™ã‚‹ã¨ãã¯ã€ã“ã‚“ãªæ„Ÿã˜ã€‚`.bashrc`ã¨ã‹`.zshrc`ã¨ã‹ã§ç’°å¢ƒå¤‰æ•°ã«ç™»éŒ²ã—ã¦ãŸã‚‰ã€`npx ts-node index.ts`ã§OKã€‚

```
SPEECH_TO_TEXT_APIKEY=APIKEY SPEECH_TO_TEXT_SERVICE_URL=https://APIURL npx ts-node index.ts
```

çµæœã¯ã“ã‚“ãªæ„Ÿã˜ã®jsonã§è¿”ã£ã¦ãã‚‹ã€‚`result.results[0].alternatives[0].transcript`ã«æ–‡å­—èµ·ã“ã—çµæœãŒå…¥ã£ã¦ã‚‹ã€‚ã„ã„æ„Ÿã˜ã€‚

```json
{
  "status": 200,
  "statusText": "OK",
  "headers": {
    "ã„ã‚ã„ã‚": "çœç•¥"
  },
  "result": {
    "result_index": 0,
    "results": [
      {
        "final": true,
        "alternatives": [
          {
            "transcript": "several tornadoes touched down as a line of severe thunderstorms swept through Colorado on Sunday ",
            "confidence": 0.94
          }
        ]
      }
    ]
  }
}
```

# ãŠã‚ã‚Šã«
ã‚‚ã†ã¡ã‚‡ã„ã€è¿·ã„ãªãŒã‚‰è©¦ã—ã¦ãŸã‘ã©ã€æŒ¯ã‚Šè¿”ã£ã¦æ•´ç†ã—ã¦ã¿ãŸã‚‰ã€å…¬å¼ã‚µã‚¤ãƒˆã®æƒ…å ±è¦‹ãŸã‚‰ä¸€ç™ºãªæ„Ÿã˜ã‚„ã£ãŸã€‚ã¾ã˜ã‚ã«ã€å…¬å¼ã‚µã‚¤ãƒˆè¦‹ã‚ˆã†ã£ã¦ã“ã¨ã‹ã€‚ã€‚ã€‚
