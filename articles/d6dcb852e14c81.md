---
title: "LangChainã‚„ã‚‹ãªã‚‰Pythonã‚ˆã‚ŠTypeScriptã®æ–¹ãŒã„ã‚“ã˜ã‚ƒã­ï¼Ÿ"
emoji: "ğŸ¦œ"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: [langchain, python, typescript, javascript, llm]
published: true
---

# ã¯ã˜ã‚ã«

LangChain ã‚’ Python ã§å‹•ã‹ã—ã¦ã„ã‚‹ã‚½ãƒ•ãƒˆã‚¦ã‚§ã‚¢ã‚¨ãƒ³ã‚¸ãƒ‹ã‚¢ã®æ–¹ã€…ã«æ„è¦‹ã‚’èã„ã¦ã¿ãŸã„ã‚“ã§ã™ãŒã€ã€ŒLangChain ã‚„ã‚‹ãªã‚‰ Python ã‚ˆã‚Š TypeScript ã®æ–¹ãŒã„ã‚“ã˜ã‚ƒã­ï¼Ÿã€ã£ã¦æ€ã†ã“ã¨ã‚ã‚Šã¾ã›ã‚“ï¼Ÿã‚ã‚Šã¾ã™ã‚ˆã­ï¼Ÿãƒ»ãƒ»ãƒ»ãˆï¼Ÿãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãªã„ï¼Ÿï¼Ÿï¼Ÿãƒ»ãƒ»ãƒ»ãˆï¼Ÿãƒ»ãƒ»ãƒ»ã‚ã‚‹ã§ã—ã‚‡ï¼Ÿ

ã¨ã„ã†ã“ã¨ã§ã€LangChain ã® JS/TS ç‰ˆã® LangChain.js ã«ã¤ã„ã¦æ›¸ã„ã¦ã„ã“ã†ã¨æ€ã„ã¾ã™ãƒ¼ã€‚

è‡ªåˆ†ãŒ Python ã®æ›¸ãæ–¹ã‚ˆãåˆ†ã‹ã£ã¦ãªã„ã£ã¦ã®ãŒä¸€ç•ªã®ç†ç”±ã ã¨æ€ã†ã‚“ã§ã™ãŒã€LangChain è§¦ã£ã¦ã‚‹ã¨ã€TypeScript ã§æ›¸ããŸã„ãªãã€TypeScript ã§æ›¸ããŸã„ã‚“ã‚ˆãªãã€TypeScript ã§æ›¸ã‘ãŸã‚‰ã„ã„ã®ã«ãƒ»ãƒ»ãƒ»ã£ã¦æ€ã£ãŸã‚Šã—ã¦ã¾ã™ã€‚Python ã®æ–¹ãŒè‰¯ã„ã¨ã“ã‚ã‚‚ã‚ã‚‹ã®ã¯æ‰¿çŸ¥ã—ã¦ã‚‹ã¤ã‚‚ã‚Šãªã‚“ã§ã™ãŒã€TypeScript ã§æ›¸ã‘ãŸã‚‰ã€ã‚‚ã£ã¨ãƒ‡ãƒãƒƒã‚°æ¥½ãªã‚“ã ã‘ã©ãªãƒ¼ã€æ›¸ã„ã¦ã¦æ°—æŒã¡ã„ã‚“ã ã‘ã©ãªãƒ¼ã€å®Ÿè¡Œä¸­ã«ã‚¨ãƒ©ãƒ¼ã§æ­¢ã¾ã‚‰ãªã„ã ã‘ã©ãªãƒ¼ã¨æ€ã£ãŸã‚Šã—ã¦ã¾ã™ã€‚

ã¨ã„ã†ã“ã¨ã§ï¼ˆ2 å›ç›®ï¼‰ã€LangChain.js ã«ã¤ã„ã¦èª¿ã¹ãŸã“ã¨ã‚’æ›¸ã„ã¦ã„ããŸã„ã¨æ€ã„ã¾ã™ã€‚

# å‰æ

LangChain ã«ã¤ã„ã¦ã¯ã‚ã‚‹ç¨‹åº¦ã€çŸ¥ã£ã¦ã‚‹å‰æã§æ›¸ã“ã†ã¨æ€ã„ã¾ã™ã€‚
ã‚‚ã—çŸ¥ã‚‰ãªã„ã‹ãŸã„ã‚Œã°ã€ã“ã®æœ¬ã™ã”ãã‚ã‹ã‚Šã‚„ã™ã‹ã£ãŸã®ã§ãŠã™ã™ã‚ã§ã™ã€‚
https://gihyo.jp/book/2023/978-4-297-13839-4

è‘—è€…ã®æ–¹ã® Udemy ã‚‚ã™ã”ãã‚ã‹ã‚Šã‚„ã™ã‹ã£ãŸã®ã§ãŠã™ã™ã‚ã§ã™ã€‚
https://www.udemy.com/course/langchain-apps/

å…¬å¼ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚‚å……å®Ÿã—ã¦ã‚‹ã®ã§è¦‹ã¦ã¿ã‚‹ã¨ã„ã„ã¨æ€ã„ã¾ã™ã€‚
https://python.langchain.com/docs/get_started/introduction

ã¾ãŸã€kansai.ts ã£ã¦ã‚³ãƒŸãƒ¥ãƒ‹ãƒ†ã‚£ã®ã‚¤ãƒ™ãƒ³ãƒˆã§ç™ºè¡¨ã—ãŸå†…å®¹ã‚’å…ƒã«åŠ ç­†ä¿®æ­£ã—ã¦æ›¸ã„ã¦ã¾ã™ãƒ¼ã€‚
https://kansaits.connpass.com/event/299545/
https://speakerdeck.com/optimisuke/langchainyarunarapythonyoritypescriptnofang-gainziyane

ã¨ã„ã†ã“ã¨ã§ï¼ˆ3 å›ç›®ï¼‰ã€æ¬¡ã‹ã‚‰ã€LangChain.js ã«ã¤ã„ã¦è©³ã—ãæ›¸ã„ã¦ã„ã“ã†ã¨æ€ã„ã¾ã™ãƒ¼ã€‚

# LangChain.jsï¼Ÿ

LangChain.js ã¯ LangChain ã® JS/TS ç‰ˆã§ã™ã€‚Python ç‰ˆã¨åŒã˜ãå…¬å¼ã®ã‚³ãƒ¼ãƒ‰ã§ã™ã€‚
https://www.langchain.com/

ã¡ãªã¿ã«ã€Java ã¨ã‹ Go ã¨ã‹ã‚‚æ¢ã—ãŸã‚‰ã‚ã‚‹ã‘ã©ã€éå…¬å¼ã£ã½ã„ã§ã™ã€‚ãªã‚“ã§ã€å…¬å¼ã¯ Python ã¨ TypeScript ã ã‘ãªã‚“ã§ã™ã‹ã­ãƒ¼ï¼Ÿ

https://github.com/tmc/langchaingo
https://github.com/langchain4j/langchain4j

TypeScript ã¨ã„ã£ã¦ã‚‚å®Ÿè¡Œç’°å¢ƒã¯è‰²ã€…ã‚ã‚‹ã‚“ã§èª¿ã¹ã¦ã¿ã‚‹ã¨ã€çµæ§‹è‰²ã€…ãªç’°å¢ƒã«å¯¾å¿œã—ã¦ã¦ã„ã„æ„Ÿã˜ã«å‹•ãã“ã¨ãŒã‚ã‹ã‚Šã¾ã™ã€‚

```
Supported Environments
LangChain is written in TypeScript and can be used in:

Node.js (ESM and CommonJS) - 18.x, 19.x, 20.x
Cloudflare Workers
Vercel / Next.js (Browser, Serverless and Edge functions)
Supabase Edge Functions
Browser
Deno
```

TS/JS ã¯ã“ã“ã‚‰ãŒã‚„ã‚„ã“ã—ãã¦ã‚ã‚Œãªã‚“ã§ã™ãŒã€ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã§å‹•ã‹ã™ã®ãŒãƒ¡ã‚¤ãƒ³ãªæ°—ãŒã™ã‚‹ã®ã§ã€ã¨ã‚Šã‚ãˆãš Node.js ã§å‹•ã‘ã°ãã‚Œã§ã„ã„ãã‚‚ã—ã¾ã™ã€‚ãŸã ã€æ˜¨ä»Šã®ã„ã‚ã‚“ãªã¨ã“ã‚ã§ JavaScript ã‚’å‹•ã‹ã—ã¡ã‚ƒã†æµã‚Œã«ã®ã£ã¦ã„ã¦ã€ã„ã‚ã‚“ãªã¨ã“ã‚ã§å‹•ãã¾ã™ã€‚ã‚ˆãåˆ†ã‹ã£ã¦ãªã„ã‘ã©ã€ã‚¨ãƒƒã‚¸ã¨ã‹ã‚‚ã€‚Vercel ã¨ã‹ Cloudflareã€Supabase ã®åå‰ãŒã‚ã‚‹ã®ã§ã€çµæ§‹ãã“ã‚‰ã¸ã‚“ã«ã‚³ãƒ³ãƒˆãƒªãƒ“ãƒ¥ãƒ¼ãƒˆã—ã¦ã‚‹ã‚“ã‚„ã‚ã†ãªãã¨æ€ã„ã¾ã™ã€‚
Node.js ã§å‹•ãã®ã§ã€æ™®é€šã«ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã‚µãƒ¼ãƒãƒ¼ã¨ã—ã¦ãƒ‡ãƒ—ãƒ­ã‚¤ã§ãã¡ã‚ƒã„ã¾ã™ã€‚ã“ã®å¾Œã€å°‘ã—èª¬æ˜ã™ã‚‹ Vercel AI SDK ã‚’ä½¿ã£ãŸã‚‰ã€ChatGPT ã¿ãŸã„ã«æ–‡å­—ãŒãƒã‚³ãƒã‚³å‡ºã¦ãã‚‹ã‚¹ãƒˆãƒªãƒ¼ãƒ ãª API ã‚’ç°¡å˜ã«ä½œã‚Œã‚‹ã®ã§ã€ã‚‚ã†ã“ã‚Œã§ã„ã‚“ã˜ã‚ƒã­ã£ã¦æ„Ÿã˜ã—ã¾ã™ã€‚

https://sdk.vercel.ai/docs

ãŸã ã€ã©ã†ã—ã¦ã‚‚ Python ã®æ–¹ãŒå…ˆã«é–‹ç™ºã•ã‚Œã¦ã‚‹ã£ã½ã„ã®ã§ã€æ–°ã—ã„æ©Ÿèƒ½ãŒå¾Œè¿½ã„ãªå°è±¡ã§ã™ã€‚ã¡ãªã¿ã«ã€Python ã®æ–¹ã ã‘ LangServe ã£ã¦ã„ã† FastAPI ä½¿ã£ã¦ REST API ä½œã‚‹æ©Ÿèƒ½ãŒã‚ã‚‹ã¿ãŸã„ãªã‚“ã§ã™ãŒã€TypeScript ã§ã‚ã‚Œã° Express ã§ã‚‚ Next.js ã§ã‚‚ NestJS ã§ã‚‚å¥½ããªãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ã§ API ä½œã‚Œã‚‹ã®ã§ã€æ°—ã«ã—ãªãã¦ã„ã„ã¨æ€ã£ã¦ã¾ã™ã€‚Web ã‚¢ãƒ—ãƒªã¯ TypeScript/JavaScript ã®ã‚¨ã‚³ã‚·ã‚¹ãƒ†ãƒ ã®æ–¹ãŒå……å®Ÿã—ã¦ã„ã‚‹ã®ã§ã€Python ã˜ã‚ƒãªãã¦ TypeScript ã§ã„ã„ã‚“ã˜ã‚ƒã­æ„Ÿã€å¼·ã„ã§ã™ã€‚

# LangChain.js ã‚’æ¨ã™ 5 ã¤ã®ç†ç”±

æ”¹ã‚ã¦ã€ã“ã“ã§æ¨ã—ãƒã‚¤ãƒ³ãƒˆã‚‚æ•´ç†ã—ã¦ã¿ã¾ã—ãŸã€‚

1. ã‚¹ã‚¯ãƒªãƒ—ãƒˆè¨€èªã§ Web ã‚¢ãƒ—ãƒªä½œã‚‹ãªã‚‰ã€ã©ã†ã›ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã¯ TypeScript ã‚„ã—ã€ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã‚‚ãã‚Œã§ã‚ˆãã­ï¼Ÿ
2. ã‚¢ãƒ—ãƒªä½œã‚‹ã®ã¯ãƒ‡ãƒ¼ã‚¿ã‚µã‚¤ã‚¨ãƒ³ãƒ†ã‚£ã‚¹ãƒˆã˜ã‚ƒãªã„ã—ã€TypeScript ã§ã‚ˆãã­ï¼Ÿ
3. Python ã§å‹ãƒ’ãƒ³ãƒˆæ›¸ããã‚‰ã„ãªã‚‰ã€åˆ¥ã« TypeScript ã§è‰¯ãã­ï¼Ÿ
4. ä¸­ç´šè€…ãƒ»ä¸Šç´šè€…å‘ã‘ã® Python æƒ…å ±ã£ã¦æ¤œç´¢ã™ã‚‹ã®ã¤ã‚‰ãã­ï¼Ÿï¼†TypeScript ã§æ¤œç´¢ã™ã‚‹ã¨å¿…è¦ãªæƒ…å ±è¦‹ã¤ã‘ã‚„ã™ãã­ï¼Ÿ
5. TypeScript ã£ã¦ãªã‚“ã‹ã‚ˆãã­ï¼Ÿ

æœ€å¾Œã€é©å½“ã§ã™ãŒã€ã“ã‚“ãªæ°—æŒã¡ã§ã™ã€‚Python ã®æ–¹ãŒãƒ‡ãƒ¼ã‚¿ã‚µã‚¤ã‚¨ãƒ³ãƒ†ã‚£ã‚¹ãƒˆã¨ã‹ã„ã‚ã‚“ãªãƒ­ãƒ¼ãƒ«ã®äººã¨ä¸€ç·’ã«ä½œã‚ŒãŸã‚Šã€Jupyter Notebook ã§è©¦è¡ŒéŒ¯èª¤ã—ãªãŒã‚‰ä½œã‚ŒãŸã‚Šã€æ©Ÿæ¢°å­¦ç¿’ç³»ã®ãƒ©ã‚¤ãƒ–ãƒ©ãƒªãŒå……å®Ÿã—ã¦ãŸã‚Šã€è‰¯ã„ã¨ã“ã‚ã‚‚ã‚ã‚‹ã¨ã¯æ€ã£ã¦ã¾ã™ã€‚ãŸã ã€TypeScript ã®æ–¹ãŒæ›¸ã„ã¦ã¦å®‰å¿ƒæ„Ÿã‚ã‚‹ã‚“ã™ã‚ˆã­ãƒ¼ã€‚Python ã¯å®Ÿè¡Œã—ã¦ã‹ã‚‰ã‚¨ãƒ©ãƒ¼ã§æ­¢ã¾ã‚‹ã®ãŒã»ã‚“ã¨è¾›ã„ãƒ»ãƒ»ãƒ»ã€‚å‹•ãã‹ä¸å®‰ãªæ°—æŒã¡ã§æ›¸ãç¶šã‘ã‚‹ã®è¾›ã„ã€‚ã€‚ã€‚ãƒ†ã‚¹ãƒˆé§†å‹•ã«ã—ãŸã‚Šã€å‹ãƒ’ãƒ³ãƒˆæ›¸ã„ãŸã‚Šã€è‰¯ã„è§£æ±ºæ–¹æ³•ã¯ã‚ã‚‹ã®ã‹ã‚‚ã—ã‚Œãªã„ã‘ã©ã€‚

ã‚ã‚‹ç¨‹åº¦ãŠæ°—æŒã¡ã‚’è¡¨æ˜ã§ããŸã®ã§ã€ã“ã“ã‹ã‚‰ã¯ LangChain.js ã®ä½¿ã„æ–¹ã«ã†ã¤ã£ã¦ã„ãã¾ã™ã€‚

# LangChain.js åŸºç¤ç·¨

ã¾ãšã¯ã€ã‚·ãƒ³ãƒ—ãƒ«ã«ãƒ¦ãƒ¼ã‚¶ãƒ¼å…¥åŠ›ã‚’ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã«åŸ‹ã‚è¾¼ã‚“ã§ã€ãƒ¢ãƒ‡ãƒ«ã«æ¸¡ã—ã€å‡ºåŠ›çµæœã‚’ãƒ‘ãƒ¼ã‚¹ã™ã‚‹ã‚³ãƒ¼ãƒ‰ã‚’è¦‹ã¦ã¿ã¾ã™ã€‚

```ts
import { ChatOpenAI } from "langchain/chat_models/openai";
import { ChatPromptTemplate } from "langchain/prompts";
import { StringOutputParser } from "langchain/schema/output_parser";

const prompt = ChatPromptTemplate.fromMessages([
  ["human", "Tell me a short joke about {topic}"],
]);
const model = new ChatOpenAI({});
const outputParser = new StringOutputParser();

const chain = prompt.pipe(model).pipe(outputParser);

const response = await chain.invoke({
  topic: "ice cream",
});
console.log(response);
/**
Why did the ice cream go to the gym?
Because it wanted to get a little "cone"ditioning!
 */
```

ã“ã®ã‚³ãƒ¼ãƒ‰ã¯ã“ã“ã‚‰ã‹ã‚‰ã‚³ãƒ”ãƒšã—ãŸã‚‚ã®ã§ã™ã€‚
https://js.langchain.com/docs/expression_language/get_started
LangChain ã¯ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆãŒå……å®Ÿã—ã¦ã„ã¦ã€
æ§‹æˆã¯ã“ã‚“ãªæ„Ÿã˜ã«ãªã£ã¦ã„ã¦ã€ç¹‹ãŒã£ã¦ã„ãæ„Ÿã˜ãŒ"chain"ã£ã½ããªã£ã¦ã„ã¾ã™ã€‚
![](/images/2023-12-08-23-29-35.png)

ã‚³ãƒ¼ãƒ‰ã‚’ã¿ã‚‹ã¨ã€ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã¨ãƒ¢ãƒ‡ãƒ«ã¨ãƒ‘ãƒ¼ã‚µãƒ¼ã®ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã‚’ãã‚Œãã‚Œä½œæˆã—ã¦ã€`pipe`ã§ç¹‹ã„ã§`chain`ã‚’ä½œã£ã¦ã€æœ€å¾Œã«ãƒ¦ãƒ¼ã‚¶ãƒ¼å…¥åŠ›ã‚’æƒ³å®šã—ãŸå¼•æ•°ã‚’æ¸¡ã—ã¦å®Ÿè¡Œã—ã¦ã„ã¾ã™ã€‚ã¨ã¦ã‚‚ã‚·ãƒ³ãƒ—ãƒ«ã§ã™ãŒã€LangChain ã®æ‹¡å¼µæ€§ãŒé«˜ãã†ãªé›°å›²æ°—ãŒé†¸ã—å‡ºã•ã‚Œã¦ã„ã‚‹ã¨æ€ã„ã¾ã™ã€‚

ã¡ãªã¿ã«ã€Python ã ã¨`|`ã‚’ä½¿ã£ã¦ Linux ã®ãƒ‘ã‚¤ãƒ—ã£ã½ãå‡¦ç†ã‚’ç¹‹ã„ã§ã„ã‘ã¾ã™ãŒã€TypeScript ã§ã¯ã€`.pipe`ã§ç¹‹ã„ã§ã„ãã¾ã™ã€‚ãƒ‘ã‚¤ãƒ—ã§ç¹‹ãã®ã‚‚é¢ç™½ã„ã¨æ€ã„ã¾ã™ãŒã€è«–ç†å’Œã®æ¼”ç®—å­ã‚’ã‚ªãƒ¼ãƒãƒ¼ãƒ­ãƒ¼ãƒ‰ã™ã‚‹ã—ã¦ã‚‹ã®ãŒé»’é­”è¡“æ„Ÿã‚ã£ã¦ã€ãã“ã¾ã§ã›ã‚“ã§ã‚‚ã„ã„ã®ã«ã£ã¦æ€ã£ãŸã‚Šã—ã¾ã™ã€‚ä½¿ã£ã¦ãŸã‚‰ä¾¿åˆ©ãªã®ã‹ã‚‚ã—ã‚Œã¾ã›ã‚“ãŒã€‚

æœ€å¾Œã®ãƒ‘ãƒ¼ã‚¹éƒ¨åˆ†ã¯ã€LLM ã®å‡ºåŠ›ã®ãƒ†ã‚­ã‚¹ãƒˆéƒ¨åˆ†ã‚’å–ã‚Šå‡ºã—ã¦ã‚‹ã ã‘ã§ã™ãŒã€Json ç­‰ã€ã„ã‚ã‚“ãªãƒ‘ãƒ¼ã‚µãƒ¼ãŒã‚ã‚‹ã¿ãŸã„ã§ã™ã€‚

https://js.langchain.com/docs/modules/model_io/output_parsers/

# LangChain.js å¿œç”¨ç·¨

æ¬¡ã«ã€LLM ã®è‰¯ãã‚ã‚‹æ´»ç”¨æ–¹æ³•ã¨ã—ã¦ã® Retrieval-Augmented Generation (RAG)ã®æ§‹ç¯‰æ–¹æ³•ã«ã¤ã„ã¦ã¿ã¦ã„ãã¾ã™ã€‚
RAG ã¯ã€æ¤œç´¢ã§æ‹¡å¼µã—ãŸç”Ÿæˆã¨ã„ã†ã“ã¨ã§ã€è³ªå•æ–‡ã«é–¢ä¿‚ã™ã‚‹æƒ…å ±ã‚’ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‹ã‚‰æ¤œç´¢ã—ã€ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã®ä¸­ã«åŸ‹ã‚è¾¼ã‚“ã§ã€LLM ã«ã„ã„æ„Ÿã˜ã®å›ç­”ã‚’ä½œã£ã¦ã‚‚ã‚‰ã†ä»•çµ„ã¿ã®ã“ã¨ã§ã™ã€‚ã¨ã¦ã‚‚ã‚·ãƒ³ãƒ—ãƒ«ãªæ–¹æ³•ã§ã™ãŒã€LLM ã‚’å†å­¦ç¿’ã›ãšã«ã€ä¼æ¥­ã‚„å€‹äººã®ãƒ‡ãƒ¼ã‚¿ã‚’å…ƒã«æ–‡ç« ã‚’ç”Ÿæˆã—ã¦ã‚‚ã‚‰ã†ã“ã¨ãŒã§ãã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚OpenAI ã® GPTs ã‚’ä½¿ã†ã¨ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã—ã¦ã€ãã®æƒ…å ±ã‚‚è¸ã¾ãˆã¦å›ç­”ã—ã¦ãã‚Œã‚‹ã®ã§ã€RAG ã¨è¨€ãˆãã†ã§ã™ã€‚ã¾ãŸã€Microsoft Bing ã‚‚ web ä¸Šã®æ¤œç´¢çµæœã‚’å…ƒã«å›ç­”ã—ã¦ãã‚Œã‚‹ã®ã§ç«‹æ´¾ãªï¼ˆã‚‚ã®ã™ã”ãç«‹æ´¾ãªï¼‰RAG ã§ã™ã€‚

![](/images/2023-12-09-19-43-56.png)

ä»¥ä¸‹ã®ä¾‹ã§ã¯ã€éå¸¸ã«ã‚·ãƒ³ãƒ—ãƒ«ãªãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚’æº–å‚™ã—ã¦ã€è³ªå•æ–‡ã«ä¼¼ãŸãƒ‡ãƒ¼ã‚¿ã‚’ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‹ã‚‰æ¤œç´¢ã—ã€çµæœã‚’ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã«`context`ã¨ã—ã¦å…¥ã‚Œã€å›ç­”ã‚’ç”Ÿæˆã—ã¦ã„ã¾ã™ã€‚

```ts
import { ChatOpenAI } from "langchain/chat_models/openai";
import { HNSWLib } from "langchain/vectorstores/hnswlib";
import { OpenAIEmbeddings } from "langchain/embeddings/openai";
import { PromptTemplate } from "langchain/prompts";
import {
  RunnableSequence,
  RunnablePassthrough,
} from "langchain/schema/runnable";
import { StringOutputParser } from "langchain/schema/output_parser";
import { formatDocumentsAsString } from "langchain/util/document";

const model = new ChatOpenAI({});

const vectorStore = await HNSWLib.fromTexts(
  ["mitochondria is the powerhouse of the cell"],
  [{ id: 1 }],
  new OpenAIEmbeddings()
);
const retriever = vectorStore.asRetriever();

const prompt =
  PromptTemplate.fromTemplate(`Answer the question based only on the following context:
{context}

Question: {question}`);

const chain = RunnableSequence.from([
  {
    context: retriever.pipe(formatDocumentsAsString),
    question: new RunnablePassthrough(),
  },
  prompt,
  model,
  new StringOutputParser(),
]);

const result = await chain.invoke("What is the powerhouse of the cell?");

console.log(result);

/*
  "The powerhouse of the cell is the mitochondria."
*/
```

ã“ã‚Œã‚‚å…¬å¼ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã®ã‚³ãƒ¼ãƒ‰ã‚’ã‚³ãƒ”ãƒšã—ãŸã‚‚ã®ã§ã™ã€‚
https://js.langchain.com/docs/expression_language/cookbook/retrieval

å…ˆã»ã©ã®ã‚³ãƒ¼ãƒ‰ã‚ˆã‚Šé•·ã„ã§ã™ãŒã€é›°å›²æ°—ã¯åŒã˜ã§ã™ã€‚
æœ€åˆã«ã€ãƒ¢ãƒ‡ãƒ«ãƒ»ãƒ™ã‚¯ã‚¿ãƒ¼ã‚¹ãƒˆã‚¢ï¼ˆãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ï¼‰ãƒ»ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã‚ãŸã‚Šã®ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã‚’ä½œã‚Šã¾ã™ã€‚ã¾ãŸã€ãƒ™ã‚¯ã‚¿ãƒ¼ã‚¹ãƒˆã‚¢ã‹ã‚‰æ¤œç´¢ã‚’ã—ã¦ãã‚Œã‚‹`retriever`ã‚’ä½œã‚Šã¾ã™ã€‚chain ã¯ã€`pipe()`ã§ã¯ãªãã€`RunnableSequence.from()`ã‚’ä½¿ã£ã¦ä½œã£ã¦ã„ã¾ã™ã€‚ã¾ãšã€chain å‘¼ã³å‡ºã—æ™‚ã®å…¥åŠ›æ–‡å­—åˆ—ã‚’`retriever`ã«å…¥ã‚Œã¦æ¤œç´¢ã—ã€å¾—ã‚‰ã‚ŒãŸè¤‡æ•°ã®çµæœã‚’ String ã«å¤‰æ›ã—ã¦ãã‚Œã‚‹`formatDocumentsAsString`ã«æ¸¡ã—ã€ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã®`context`ã«åŸ‹ã‚è¾¼ã¿ã¾ã™ã€‚ã¾ãŸã€ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã®`question`ã®ã¨ã“ã‚ã«ã¯ã€chain ã®å…¥åŠ›æ–‡å­—åˆ—ã‚’ãã®ã¾ã¾å…¥ã‚Œã¦ã„ã¾ã™ã€‚`new RunnablePassthrough()`ã®éƒ¨åˆ†ãŒã€å°‘ã—ç„¡é§„ã«è¦‹ãˆã‚‹ã‹ã‚‚ã—ã‚Œã¾ã›ã‚“ãŒã€ãã®ã¾ã¾å…¥åŠ›ã™ã‚‹ãŸã‚ã«ã¯ã“ã†ã„ã†ãµã†ã«æ›¸ãã‚‰ã—ã„ã§ã™ã€‚ã“ã‚“ãªæ„Ÿã˜ã§ chain ã®æœ€åˆã«è¤‡æ•°ã®å…¥åŠ›ãŒã‚ã£ãŸã‚‰å…¨ã¦ã« chain å‘¼ã³å‡ºã—æ™‚ã®å…¥åŠ›ãŒæ¸¡ã•ã‚Œã‚‹ã¿ãŸã„ã§ã™ã€‚ãã®ã‚ã¨ã¯å…ˆã»ã©ã¨åŒã˜ã‚ˆã†ã«ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã‚’ãƒ¢ãƒ‡ãƒ«ã«æ¸¡ã—ã€ãƒ‘ãƒ¼ã‚µãƒ¼ã§ String å‹ã«ã—ã¾ã™ã€‚æœ€å¾Œã«ã€`chain.invoke()`ã§å…¥åŠ›ã‚’æ¸¡ã—ã¦å®Ÿè¡Œã—ã¾ã™ã€‚
retriever ã‚‚ prompt ã‚‚ model ã‚‚ String ã‚’ã‚¤ãƒ³ãƒ—ãƒƒãƒˆã¨ã—ã¦ç·©ã‚„ã‹ã«ç¹‹ãŒã£ã¦ã„ã¦ã€ã†ã¾ã„ã“ã¨ãªã£ã¦ã¦ã™ã”ã„ãªãƒ¼ã¨ã„ã†å°è±¡ã§ã™ã€‚

ãã‚Œãã‚Œã®å‹•ãã«ã¤ã„ã¦ã¯ä¸‹è¨˜ api ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã«è‰²ã€…æ›¸ã‹ã‚Œã¦ã„ã‚‹ã®ã§ã€å¿…è¦ã«å¿œã˜ã¦ã‚³ãƒ¼ãƒ‰ã¨ä¸€ç·’ã«çœŸé¢ç›®ã«èª­ã‚€ã®ãŒã„ã„ã‹ãªã¨æ€ã„ã¾ã™ã€‚ä¾‹ãˆã°ã€ä»¥ä¸‹ã®ã‚µã‚¤ãƒˆã‚’ã¿ã‚‹ã¨ã€VectorStoreRetriever ã¯ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§`k`ã¨ã„ã†æ¤œç´¢å€‹æ•°ã®ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ãŒ 4 ã ã‹ã‚‰ã€retriever ã®å‡ºåŠ›ã¯ 4 ã¤ã®æ¤œç´¢çµæœãŒå«ã¾ã‚ŒãŸé…åˆ—ã§ã€`formatDocumentsAsString`ãŒ 4 ã¤ã®æ¤œç´¢çµæœã‚’æ”¹è¡Œã§åŒºåˆ‡ã£ã¦ä¸€ã¤ã® String ã«ã—ã¦ãã†ã ãªãã¨ã‹ã„ã†ã®ãŒåˆ†ã‹ã£ãŸã‚Šã—ã¾ã™ã€‚

https://api.js.langchain.com/classes/vectorstores_base.VectorStoreRetriever.html
https://api.js.langchain.com/functions/util_document.formatDocumentsAsString.html

# Next.js + LangChain.js

æ¬¡ã«ã€LangChain.js ã‚’ã‚‚ã†å°‘ã—çŸ¥ã‚‹ãŸã‚ã«ã€ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚’ç´¹ä»‹ã—ãŸã„ã¨æ€ã„ã¾ã™ã€‚Next.js ãªä¸Šã«ã€Vercel ã® SDK ä½¿ã£ãŸã‚Šã€Vercel ã®ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ ä¸Šã«ãƒ‡ãƒ—ãƒ­ã‚¤ã—ã¦ã„ãŸã‚Šã€Vercel ã®äººãŒä½œã£ã¦ã‚‹æ„Ÿã‚ã‚Šã¾ã™ãŒã€ã‚·ãƒ³ãƒ—ãƒ«ã‹ã¤å®Ÿè·µçš„ã§ã„ã„æ„Ÿã˜ã§ã™ã€‚ä¸­èº«ã¯å…¨éƒ¨ã§ 5 ç¨®é¡ã®ãƒãƒ£ãƒƒãƒˆãƒœãƒƒãƒˆãŒã‚ã£ã¦ã€RAG ãƒ‘ã‚¿ãƒ¼ãƒ³ã‚„ Agent ã¨å‘¼ã°ã‚Œã‚‹ LLM ã¨ api å‘¼ã³å‡ºã—ã‚’é€£æºã•ã›ã‚‹ãƒ‘ã‚¿ãƒ¼ãƒ³ã‚‚è©¦ã›ã¾ã™ã€‚

https://github.com/langchain-ai/langchain-nextjs-template

ã¾ãšã¯ã€ä¸‹è¨˜ãƒªãƒ³ã‚¯ã‹ã‚‰å®Ÿéš›ã«å‹•ã‹ã—ã¦ã¿ã‚‹ã®ãŒãŠå‹§ã‚ã§ã™ã€‚Retrieval (RAG) ã®éƒ¨åˆ†ã¯ä¸‹è¨˜ãƒªãƒ³ã‚¯ã‹ã‚‰ã¯å‹•ã‹ãªã„ã®ã§è‡ªåˆ†ã§è‰²ã€…è¨­å®šã—ã¦å‹•ã‹ã™å¿…è¦ã‚ã‚Šã¾ã™ã€‚
https://langchain-nextjs-template.vercel.app/

ã‚³ãƒ¼ãƒ‰ã‚‚è¦‹ã¦ã¿ã‚‹ã¨ã€ä¸€ç•ªã‚·ãƒ³ãƒ—ãƒ«ãªãƒãƒ£ãƒƒãƒˆãƒœãƒƒãƒˆã® API ã¯ä»¥ä¸‹ã®ã‚ˆã†ã«ãªã£ã¦ã„ã¾ã™ã€‚

```ts
import { NextRequest, NextResponse } from "next/server";
import { Message as VercelChatMessage, StreamingTextResponse } from "ai";

import { ChatOpenAI } from "langchain/chat_models/openai";
import { BytesOutputParser } from "langchain/schema/output_parser";
import { PromptTemplate } from "langchain/prompts";

export const runtime = "edge";

const formatMessage = (message: VercelChatMessage) => {
  return `${message.role}: ${message.content}`;
};

const TEMPLATE = `You are a pirate named Patchy. All responses must be extremely verbose and in pirate dialect.

Current conversation:
{chat_history}

User: {input}
AI:`;

export async function POST(req: NextRequest) {
  try {
    const body = await req.json();
    const messages = body.messages ?? [];
    const formattedPreviousMessages = messages.slice(0, -1).map(formatMessage);
    const currentMessageContent = messages[messages.length - 1].content;
    const prompt = PromptTemplate.fromTemplate(TEMPLATE);
    const model = new ChatOpenAI({
      temperature: 0.8,
    });
    const outputParser = new BytesOutputParser();

    const chain = prompt.pipe(model).pipe(outputParser);

    const stream = await chain.stream({
      chat_history: formattedPreviousMessages.join("\n"),
      input: currentMessageContent,
    });

    return new StreamingTextResponse(stream);
  } catch (e: any) {
    return NextResponse.json({ error: e.message }, { status: 500 });
  }
}
```

POST ã•ã‚Œã¦ãã‚‹ body ã®ä¸­ã®`messages`ã«ç¾åœ¨ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼å…¥åŠ›ã¨éå»ã®ã‚„ã‚Šå–ã‚ŠãŒå«ã¾ã‚Œã¦ã„ã‚‹ã®ã§ã€ãã‚Œã‚’åˆ†é›¢ã™ã‚‹éƒ¨åˆ†ãŒå°‘ã—è¤‡é›‘ã§ã™ãŒã€ä»–ã¯ä»Šã¾ã§ã¨åŒã˜ã‚ˆã†ãªæ„Ÿã˜ã§ã¨ã¦ã‚‚ã‚·ãƒ³ãƒ—ãƒ«ã«ãªã£ã¦ã„ã¾ã™ã€‚ã“ã“ã§ã¯ã€Vercel AI SDK ã‚’ä½¿ã£ã¦ã‚¹ãƒˆãƒªãƒ¼ãƒ å‡¦ç†ã§ãã‚‹ã‚ˆã†ã«ã€`stream()`ã§å‘¼ã³å‡ºã—ã¦ã€æœ€å¾Œã« Vercel AI SDK ã®`StreamingTextResponse()`ã«å…¥ã‚Œã¦è¿”ã—ã¦ã„ã¾ã™ã€‚Vercel AI SDK ã«ã¤ã„ã¦ã¯å¾Œã»ã©èª¬æ˜ã—ã¾ã™ã€‚
ã¾ãŸã€`try catch`ã—ã¦ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ã—ã¦ãŸã‚Šã—ã¾ã™ã€‚
ä»–ã®ã‚³ãƒ¼ãƒ‰ã‚„ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã®ã‚³ãƒ¼ãƒ‰ã‚‚ã„ã„æ„Ÿã˜ãªã®ã§ã€èª­ã‚“ã§ã¿ã‚‹ã¨ã„ã„ã¨æ€ã„ã¾ã™ã€‚

# Stream å‡¦ç† (Vercel AI SDK)

ä¸Šè¨˜ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã«å‡ºã¦ããŸ Vercel AI SDK ã«ã¤ã„ã¦ã‚‚å°‘ã—èª¬æ˜ã—ãŸã„ã¨æ€ã„ã¾ã™ã€‚
https://sdk.vercel.ai/docs

ä¸€ç•ªã®ç‰¹å¾´ã¯ã€LLM ã® API ã®ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‚’ stream ã§ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã«ã‚€ã£ã¡ã‚ƒç°¡å˜ã«æ¸¡ã›ã‚‹ã¨ã“ã‚ã§ã™ã€‚
![](/images/2023-12-08-23-24-17.png)

https://sdk.vercel.ai/docs/concepts/streaming

ã‚³ãƒ¼ãƒ‰ã¿ã‚‹ã®ãŒæ—©ã„ã‹ãªã¨æ€ã†ã®ã§ã€ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã«æ›¸ã‹ã‚ŒãŸã‚³ãƒ¼ãƒ‰ã‚’ç´¹ä»‹ã—ã¾ã™ã€‚
ã¾ãšã¯ã€ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ï¼ˆ`edge`ã«ã—ã¦ã¾ã™ãŒï¼‰ãŒã“ã‚“ãªæ„Ÿã˜ã§ã™ã€‚

```ts
import { NextRequest } from "next/server";
import { Message as VercelChatMessage, StreamingTextResponse } from "ai";

import { ChatOpenAI } from "langchain/chat_models/openai";
import { BytesOutputParser } from "langchain/schema/output_parser";
import { PromptTemplate } from "langchain/prompts";

export const runtime = "edge";

const formatMessage = (message: VercelChatMessage) => {
  return `${message.role}: ${message.content}`;
};

const TEMPLATE = `You are a pirate named Patchy. All responses must be extremely verbose and in pirate dialect.
 
Current conversation:
{chat_history}
 
User: {input}
AI:`;

export async function POST(req: NextRequest) {
  const body = await req.json();
  const messages = body.messages ?? [];
  const formattedPreviousMessages = messages.slice(0, -1).map(formatMessage);
  const currentMessageContent = messages[messages.length - 1].content;

  const prompt = PromptTemplate.fromTemplate(TEMPLATE);

  const model = new ChatOpenAI({
    temperature: 0.8,
  });

  const outputParser = new BytesOutputParser();

  const chain = prompt.pipe(model).pipe(outputParser);

  const stream = await chain.stream({
    chat_history: formattedPreviousMessages.join("\n"),
    input: currentMessageContent,
  });

  return new StreamingTextResponse(stream);
}
```

å…ˆã»ã©ã€ç´¹ä»‹ã—ãŸ Next.js + LangChain.js ã®ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã¨ã»ã¼åŒã˜ãªã®ã§ã‚ã‚Œã§ã™ãŒã€æœ€å¾Œã«`chain.stream()`ã‚’ã‚ˆã‚“ã§ã€ãã‚Œã‚’`new StreamingTextResponse()`ã«å…¥ã‚Œã¦è¿”ã—ã¦ã„ã‚‹ã ã‘ã§ã™ã€‚

æ¬¡ã«ã€ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã¯ã“ã‚“ãªæ„Ÿã˜ã§ã™ã€‚

```ts
"use client";

import { useChat } from "ai/react";

export default function Chat() {
  const { messages, input, handleInputChange, handleSubmit } = useChat();

  return (
    <div className="mx-auto w-full max-w-md py-24 flex flex-col stretch">
      {messages.map((m) => (
        <div key={m.id}>
          {m.role === "user" ? "User: " : "AI: "}
          {m.content}
        </div>
      ))}

      <form onSubmit={handleSubmit}>
        <label>
          Say something...
          <input
            className="fixed w-full max-w-md bottom-0 border border-gray-300 rounded mb-8 shadow-xl p-2"
            value={input}
            onChange={handleInputChange}
          />
        </label>
        <button type="submit">Send</button>
      </form>
    </div>
  );
}
```

`useChat()`ã‚’ä½¿ã†ã ã‘ã§ã€ã¨ã£ã¦ã‚‚ã‚·ãƒ³ãƒ—ãƒ«ã§ stream ã‚’æ„è­˜ã—ãªã„ã§æ›¸ã‘ã¾ã™ã€‚
ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‹ã‚‰ã®`input`ã‚’`handleSubmit`ã§é€ã£ã¦ã€LLM ã‚’å«ã‚€ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã‹ã‚‰ã®ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‚’`message`ã¨ã—ã¦å—ã‘å–ã£ã¦ã€å«ã¾ã‚Œã‚‹`role`æƒ…å ±ã‚’å…ƒã«ã€è¡¨ç¤ºã‚’åˆ‡ã‚Šæ›¿ãˆã¦ã„ã‚‹æ„Ÿã˜ã§ã™ã€‚ã™ã”ã„ã€‚ã‚·ãƒ³ãƒ—ãƒ«ã€‚ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚‚å……å®Ÿã—ã¦ã„ã‚‹ã—ã€è‰²ã€…ã§ããã†ã§ç´ æ™´ã‚‰ã—ã„ã£ã™ã­ã€‚

# ä¸­èº«ã‚’å°‘ã—

æœ€å¾Œã«ã€LangChain.js ã®ä¸­èº«ã‚’è¦‹ã¦ã¿ã‚ˆã†ã¨æ€ã„ã¾ã™ã€‚

## Model

ã“ã‚“ãªæ„Ÿã˜ã§ã€LLM ãƒ¢ãƒ‡ãƒ«ãŒã„ã„æ„Ÿã˜ã«æŠ½è±¡åŒ–ã•ã‚Œã¦ã„ã‚‹ã®ã§ã€ãƒ¢ãƒ‡ãƒ«ã‚’ç½®ãæ›ãˆã¦ã‚‚ chain ã§ç¹‹ãä»–ã®ã‚‚ã®ï¼ˆãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã‚„ãƒ‘ãƒ¼ã‚µãƒ¼ç­‰ï¼‰ã¯å¤‰æ›´ã›ãšã«å‹•ã„ãŸã‚Šã—ã¾ã™ã€‚

```ts
const model = new ChatOpenAI({
  modelName: "gpt-3.5-turbo",
});
const model = new ChatOllama({
  model: "llama2",
});
```

å„ãƒ¢ãƒ‡ãƒ«ã®ã‚¯ãƒ©ã‚¹ã¯ã“ã‚“ãªæ„Ÿã˜ã«ãªã£ã¦ã„ã¦ã€`BaseChatModel`ã‚’ extends ã—ãŸã‚‚ã®ã«ãªã£ã¦ã¾ã™ã€‚ä¸­èº«ã¯ API å‘¼ã‚“ã§ã‚‹ã ã‘ã§ã™ãŒã€ã„ã„æ„Ÿã˜ã«ãƒ©ãƒƒãƒ—ã•ã‚Œã¦ç½®ãæ›ãˆã‚„ã™ããªã£ã¦ã¾ã™ã€‚ã™ã”ã„ã€‚

```ts
export declare class ChatOpenAI<CallOptions extends ChatOpenAICallOptions = ChatOpenAICallOptions> extends BaseChatModel<CallOptions> implements OpenAIChatInput, AzureOpenAIInput
```

```ts
export declare class ChatOllama extends SimpleChatModel<OllamaCallOptions> implements OllamaInput

export declare abstract class SimpleChatModel<CallOptions extends BaseChatModelCallOptions = BaseChatModelCallOptions> extends BaseChatModel<CallOptions>
```

## Runnable

ãã—ã¦ã€ã‚³ãƒ¼ãƒ‰ã‚’è¦‹ã¦ã„ã‚‹ã¨ã‚„ãŸã‚‰å‡ºã¦ãã‚‹`Runnable`ãŠã‚ˆã³`RunnableLike`ãŒå„ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‚’ãƒã‚§ãƒ¼ãƒ³çŠ¶ã«ç¹‹ã„ã§ã„ããŸã‚ã®ãƒã‚¤ãƒ³ãƒˆã£ã½ã„ã§ã™ã€‚æ¨™æº–ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ã‚¤ã‚¹ã£ã¦ã„ã†ã®ã‹ãªï¼Ÿã¾ã ã€é›°å›²æ°—ã—ã‹åˆ†ã‹ã£ã¦ã¾ã›ã‚“ãŒã€ã©ã®ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‚‚åŒã˜ã‚ˆã†ãªãƒ¡ã‚½ãƒƒãƒ‰ãŒã‚ã£ãŸã‚ŠåŒã˜ã‚ˆã†ã«å‘¼ã³å‡ºã›ãŸã‚Šã™ã‚‹ã®ã¯`Runnable`ã§ã™ã€‚ã¾ãŸã€ã©ã†ã‚‚`Runnable`ã¯ Java æ›¸ãäººã«ã¯é¦´æŸ“ã¿æ·±ã„ã‚‚ã®ã£ã½ã„ã§ã™ã€‚Java æ›¸ã‹ãªã„ã®ã§è‰¯ãã‚ã‹ã‚Šã¾ã›ã‚“ãŒã€‚ã€‚ã€‚è‡ªåˆ†ã§ã‚«ã‚¹ã‚¿ãƒ ãƒã‚§ãƒ¼ãƒ³ã‚’ä½œã‚ŠãŸã„æ™‚ã¯ã€ã“ã“ã‚‰ã‚’ã‚‚ã†å°‘ã—ç†è§£ã™ã‚Œã°ã§ãã‚‹ã¯ãšã§ã™ã€‚

https://js.langchain.com/docs/expression_language/interface
https://api.js.langchain.com/classes/schema_runnable.Runnable.html

```ts
export declare abstract class Runnable<RunInput = any, RunOutput = any, CallOptions extends RunnableConfig = RunnableConfig> extends Serializable
```

æœ€å¾Œã®æœ€å¾Œã«ã€chain ã®ä½œã‚Šæ–¹ã§ã™ãŒã€ä»Šã¾ã§è»½ãè§¦ã‚ŒãŸã‚ˆã†ã«ã€`RunnableSequence.from()`ã¨`pipe()`ã®äºŒç¨®é¡ã‚ã‚Šã¾ã™ã€‚ã©ã¡ã‚‰ã‚’ä½¿ã£ã¦ã‚‚è‰¯ã„ã®ã§ã™ãŒã€å€‹äººçš„ã«ã¯`.pipe()`ã‚’ä½¿ã£ãŸæ–¹ãŒç¹‹ã„ã§ã‚‹æ„Ÿã‚ã‚‹ã®ã¨å…¥åŠ›ã¨å‡ºåŠ›ã®æ–¹å‘æ€§ãŒè¦‹ãˆã‚‹ã®ã§ã€ã„ã„ãªãƒ¼ã¨æ€ã£ã¦ã¾ã™ã€‚

```ts
const answerChain = RunnableSequence.from([
  {
    context: RunnableSequence.from([(input) => input.question, retrievalChain]),
    chat_history: (input) => input.chat_history,
    question: (input) => input.question,
  },
  answerPrompt,
  model,
]);

const chain = prompt.pipe(model).pipe(outputParser);
```

# ãŠã‚ã‚Šã«

LangChain.js ã¸ã®æƒ³ã„ã¨ã€ä½¿ã„æ–¹ã€Next.js ã‚„ Vercel AI SDK ã¨ã®é€£æºã®ä»•æ–¹ã€LangChain.js ã®ä¸­èº«ã«ã¤ã„ã¦ã¡ã‚‡ã£ã¨ãšã¤æ•´ç†ã—ã¦ã¿ã¾ã—ãŸã€‚èª­ã‚“ã§ã„ãŸã ãã‚ã‚ŠãŒã¨ã†ã”ã–ã„ã¾ã—ãŸã€‚Python ç‰ˆã® LangChain ã ã‘ã§ãªã LangChain.js ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒå¢—ãˆã‚Œã°ã„ã„ãªã¨æ€ã„ã¾ã™ã€‚ã¨è¨€ã„ã¤ã¤ã€è‡ªåˆ†ã‚‚ LangChain.js ã«å°‘ã—å…¥é–€ã—ãŸç¨‹åº¦ãªã®ã§ã€ã‚‚ã†å°‘ã—çœŸé¢ç›®ã«ä½¿ã£ã¦ã¿ãŸã„ãªã¨æ€ã£ã¦ã¾ã™ã€‚ï¼ˆã‚‚ã†å°‘ã— Python ã‚ã‹ã‚‹ã‚ˆã†ã«ãªã£ãŸã‚‰ Python ã§ã„ã‚“ã˜ã‚ƒã­ï¼Ÿã£ã¦æ€ã£ã¦ã‚‹å¯èƒ½æ€§ã‚‚ã‚ã‚Šã¾ã™ãŒã€‚ï¼‰ã¨ã„ã†ã“ã¨ã§ã€ã§ã¯ã§ã¯ã€ã”ãã’ã‚“ã‚ˆã†ã€‚
