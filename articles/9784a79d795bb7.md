---
title: "OpenTelemetry、5言語（Java, Python, TypeScript, Go, Rust）で自動計装してみた"
emoji: "🔭"
type: "tech" # tech: 技術記事 / idea: アイデア
topics: [grafana, opentelemetry]
published: true
---

OpenTelemetry（OTel）の「自動計装」を、Java / Python / TypeScrip (Node.js) / Go / Rust で TODO API サーバーを作って一通り触ってみました。同じ「自動」という言葉でも、方法や思想がかなり違うと感じました。
**実行時にコードへ介入できるランタイムを持つか、静的にコンパイルされ実行モデルが事前に確定するか**という違いが強く影響しており、非常に興味深かったです。簡単な感想を共有します。

![](/images/2025-12-18-11-03-18.png)

**Java** は JVM 上でのバイトコード計装が強力で、`-javaagent` に jar を足すだけ。アプリ無改修で HTTP や DB まで取れ、自動計装の理想系に近い印象です。Spring Boot でやりましたが Java も色々あるので、他も気になるところです。

**Python** はランタイム言語らしく、依存関係を入れて起動時に `opentelemetry-instrument` を噛ませるモンキーパッチ方式。起動方法は変わりますが、コード修正は最小限で済みます。

**TypeScrip (Node.js)** もランタイム前提ですが、SDK を起動時に初期化する必要があります。「自動」と言いつつ儀式は多めです。今回 logger は OTel の sdk を使いましたが、pino など既存の logger を使ったまま trace_id / span_id を自動注入できるみたいです。

**Go** は静的コンパイル言語のため、Alibaba の loongsuite OSS のようにビルドや実行方法を変えて計装しました。eBPF を使う方法もありますが、そちらは Rust で試してみました。トレースは取得でき、ログにも trace_id は入りますが、ログ自体の export は別設計が必要でした。それにしばらく気づかず時間を溶かしました。。。

**Rust** では [Grafana Beyla](https://grafana.com/ja/oss/beyla-ebpf/) を使い、[eBPF](https://ebpf.io/) による低レイヤーでの観測を試しました。アプリ無改修で HTTP トレースが取れる一方、HTTP と SQL が繋がらない場面もあり、eBPF の強さと限界を感じました。Go + Beyla だともう少しこなれているかもです。

OTel はまだ進化の途中ですが、言語差・ツール差を越える共通基盤として今後に期待しています。機会があれば、OSS 側にも貢献していきたいです。

興味持たれた方は、以下のレポジトリにコードをおいたのでぜひ眺めてみてください。

https://github.com/optimisuke/hello-otel

OTel の送信先は Grafana LGTM スタックを使っており、以下の記事でも紹介しています。

https://zenn.dev/cepe_jp/articles/c07d75daba4e35
