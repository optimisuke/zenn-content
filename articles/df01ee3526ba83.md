---
title: "Javaエンジニアのための WebAssembly 入門"
emoji: "🧑‍💻"
type: "tech" # tech: 技術記事 / idea: アイデア
topics: [webassembly, wasm, java, jvm]
published: true
---

こんにちは。この記事では、Java エンジニアの皆さんに向けて、WebAssembly（Wasm）の基本とその仕組みを紹介します。
JVM やバイトコードの概念に親しんでいる方なら、Wasm もきっとスムーズに理解できるはずです。

ただし、**Wasm は JVM の後継でも代替でもありません。** 似ているようで根本的に異なるその思想や特徴を、Java との対比を通じて解説していきます。

---

## 1. 🧱 WebAssembly って何？

Wasm は、主に**Web ブラウザで安全かつ高速にコードを実行するための中間表現**として登場しました。これは、Java のバイトコードと JVM の関係に近く、ソースコードを一度コンパクトな形式に変換して、仮想的な実行環境で動かすという仕組みを持っています。2015 年ごろから W3C（Web の標準化団体）で策定が始まり、Chrome や Firefox、Safari といった主要ブラウザに今では標準搭載されています。

📌 特徴をざっくり言うと：

- 小さくて軽量な**バイナリ形式**（コンパクトな機械語的コード）
- ネイティブ並のパフォーマンス
- セキュアな実行環境（サンドボックス＝安全にコードを実行する仕組み）
- ブラウザ以外でも使える（Edge Function、IoT など）

💡 ブラウザ外で動かす際には **WASI（WebAssembly System Interface）** という仕組みを使うことがあります。これは、Wasm にファイル操作や時計取得など、OS っぽい機能を与えるインターフェースで、**静的リンク**（ビルド時に組み込む）で使われるのが一般的です。

---

## 2. 🔍 JVM と Wasm、何が似てて何が違う？

| 項目          | Java / JVM                             | WebAssembly                      |
| ------------- | -------------------------------------- | -------------------------------- |
| 🗓️ 誕生年     | 1995 年（Sun Microsystems）            | 2015 年（W3C）                   |
| 🎯 目的       | クロスプラットフォームなアプリ実行環境 | ブラウザで高速＆安全なコード実行 |
| 💾 実行形式   | JVM バイトコード（.class）             | Wasm バイナリ（.wasm）           |
| ⚙️ 実行方式   | JIT 中心（実行時に最適化）             | AOT 中心（事前に変換）           |
| 🧹 メモリ管理 | GC あり                                | GC なし（提案中）                |
| 🧑‍💻 言語対応   | Java/Kotlin/Scala など                 | Rust/C/C++/Go など               |
| 📚 標準 API   | Java 標準ライブラリ                    | なし（WASI などで補完）          |

※ GC（Garbage Collection）：不要なメモリを自動で回収する仕組み
※ JIT（Just-In-Time）：実行時にコンパイルする仕組み
※ AOT（Ahead-Of-Time）：実行前にコンパイルする仕組み

両者とも「中間コードを仮想マシン上で動かす」という点では共通していますが、設計思想は大きく異なります。

---

## 3. 🕰️ 歴史的な背景と思想の違い

### ☕ JVM の誕生

1990 年代、Sun Microsystems は「一度書けばどこでも動く（WORA = Write Once, Run Anywhere）」を合言葉に Java と JVM を設計しました。GUI アプリ、サーバアプリ、携帯アプリ（ガラケー）…何でもこいの**オールラウンダーな仮想マシン**です。

- オブジェクト指向が前提
- GC でメモリ管理を自動化
- 豊富な標準ライブラリとセキュリティ機構

### 🌐 Wasm の誕生

2010 年代、JavaScript に限界を感じた Web 業界が求めたのは「**ブラウザで動く、軽くて速くて安全なコード実行基盤**」。Wasm は C/C++や Rust といった言語から直接ビルドできる中間フォーマットとして登場しました。

- 高速起動・低オーバーヘッド
- セキュアなメモリ制御（線形メモリ）
- GC なし。言語ごとの管理が前提

👉 Java が「開発者に優しい VM」なら、Wasm は「実行に優しい軽量な中間形式」と言えるでしょう。

---

## 4. 💾 バイトコード vs バイナリ

Java の`.class`ファイルは、1 命令あたり 1 バイト前後の命令コードで構成されており、JVM が直接実行する形式です。このため「バイトコード」と呼ばれます。

一方、Wasm はより汎用的なバイナリフォーマットとして設計されていて、構造化されたセクションごとの形式を取り、命令は可変長です。そのため「Wasm バイナリ」と呼ばれます。

どちらも「人が書くものではなく、機械が読むもの」という点では共通しています。

---

## 5. ⚙️ JVM と Wasm、それぞれの実行環境

Wasm をネイティブで動かすための軽量な実行環境（ランタイム）も複数登場しています：

- **Wasmtime**（Mozilla 系）：WASI 対応で軽量
- **WasmEdge**：AI・IoT 向けにも最適化
- **Wasmer**：マルチプラットフォーム対応

JVM 側にも：

- **GraalVM**（AOT に対応・Polyglot）
- **OpenJ9**（IBM 製の軽量 JVM）

💡 **Polyglot（ポリグロット）** とは、複数の言語を同じ実行環境で扱える仕組みのこと。GraalVM では Java だけでなく、JavaScript や Python、Ruby なども実行可能です。

📝 ちなみに JIT（Just-In-Time）と AOT（Ahead-Of-Time）もよく出てくる用語ですが、JVM は JIT が基本、Wasm は AOT が基本です。

---

## 6. 🚀 Java エンジニアから見た Wasm の可能性

### 🔸 ブラウザ内での高速処理

画像フィルター、音声処理、PDF 操作など、JS では重い処理を Rust ＋ Wasm で高速化するユースケースが増えています。

### 🔸 サーバレスへの応用

Cloudflare Workers や Fermyon の Spin など、サーバーレス関数の実行形式として Wasm が注目されています。

### 🔸 外部モジュールとしての利用

Wasm は軽量かつ安全なため、「外部から安全に実行可能なモジュール」として活用されています。ネイティブコードより安全に第三者コードを実行できる点が魅力です。

---

## 7. 📦 まとめ

Java と Wasm は、どちらも「どこでも動く中間コード」を目指しています。でもそのアプローチはまったく違います。

| 観点             | Java                                | WebAssembly                        |
| ---------------- | ----------------------------------- | ---------------------------------- |
| 中間コードの思想 | オブジェクト指向・GC 前提の VM      | 型安全・GC なし・低レベル制御      |
| 実行対象         | JVM 上のアプリ                      | ブラウザ、WASI、軽量サンドボックス |
| 向いている場面   | 大規模アプリ、Android、サーバー処理 | 軽量 Web 処理、組み込み、分離実行  |

---

## 🧩 Wasm とコンテナの関係についてもひとこと

最近では Wasm が「**軽量な実行環境**」として注目されています。Docker などのコンテナと比べて：

- 🚀 起動が非常に速い
- 📦 実行ファイルがコンパクト
- 🔐 サンドボックスで高い安全性

特にコンテナと異なり、OS に依存せずユーザーランド（ユーザーアプリが動く領域）を構成することなく実行できるのが特徴で、WASI などを通じて必要な機能だけを最小限に提供し、安全かつ高速にアプリを動かせます。

---

Java の知識を持つ方にとって、Wasm は「なじみやすく、それでいて新鮮な世界」です。
ぜひ、Wasm の楽しさを体感してみてください。🎉

※もし間違いや分かりにくいところがあれば、ぜひやさしくツッコミお願いします 🙏
